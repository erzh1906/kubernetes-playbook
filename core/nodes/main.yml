---

- name: Setup master nodes
  hosts: all:&{{ masters_group_name }}
  roles:
    - k8s_master

- name: Setup RBAC configuration for TLS bootstraping and API server to Kubelet connection
  hosts: all:&{{ masters_group_name }}[0]
  roles:
    - k8s_bootstrap_tls_rbac
    - k8s_apiserver_kubelet_rbac

- name: Setup worker nodes
  hosts: nodes
  roles:
    - k8s_worker

- name: Approve pendig Kubelet CSRs and label nodes
  hosts: all:&{{ masters_group_name }}[0]
  roles:
    - k8s_node_labels
